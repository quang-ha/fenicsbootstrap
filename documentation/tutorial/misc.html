<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Miscellaneous Topics &mdash; FEniCS Project</title>
    
    <link rel="stylesheet" href="../../_static/fenics.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.9.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="FEniCS Project" href="../../index.html" />
    <link rel="up" title="FEniCS tutorial (Python)" href="index.html" />
    <link rel="next" title="Bibliography" href="bib.html" />
    <link rel="prev" title="More Examples" href="more.html" />



<link rel="shortcut icon" href="../../_static/fenics.ico" />


<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-19595948-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  </head>
  <body>
<div class="wrapper">
  <a href="/"><img src="../../_static/fenics_banner.png" width="900px" alt="FEniCS Project Banner" /></a>
  <div id="access">
    <div class="menu">
      <ul>
	<li class="page_item"><a href="/about/" title="Find out more about the FEniCS project">About</a></li>
	<li class="page_item"><a href="/download/" title="Obtain the FEniCS project">Download</a></li>
	<li class="page_item"><a href="/documentation/" title="Learn how to use the FEniCS project">Documentation</a></li>
	<li class="page_item"><a href="/applications/" title="Learn how others are using the FEniCS project">Applications</a></li>
	<li class="page_item"><a href="/contributing/" title="Learn how to contribute to the FEniCS project">Contributing</a></li>
	<li class="page_item"><a href="/citing/" title="Learn how to cite the FEniCS project">Citing</a></li>
	<li class="page_item"><a href="/support/" title="Where to go for more help">Support</a></li>
      </ul>
    </div><!-- .menu -->
  </div><!-- #access -->
</div><!-- #wrapper -->


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="miscellaneous-topics">
<h1>Miscellaneous Topics<a class="headerlink" href="#miscellaneous-topics" title="Permalink to this headline">¶</a></h1>
<div class="section" id="glossary">
<h2>Glossary<a class="headerlink" href="#glossary" title="Permalink to this headline">¶</a></h2>
<span class="target" id="index-0"></span><span class="target" id="index-1"></span><span class="target" id="index-2"></span><span class="target" id="index-3"></span><span class="target" id="index-4"></span><span class="target" id="index-5"></span><span class="target" id="index-6"></span><span class="target" id="index-7"></span><p id="index-8">Below we explain some key terms used in this tutorial.</p>
<blockquote>
<div><dl class="docutils">
<dt>FEniCS: name of a software suite composed of many individual software</dt>
<dd>components (see <tt class="docutils literal"><span class="pre">fenicsproject.org</span></tt>). Some components are DOLFIN and
Viper, explicitly referred to in this tutorial. Others are
FFC and FIAT, heavily used by the programs appearing in this tutorial,
but never explicitly used from the programs.</dd>
<dt>DOLFIN: a FEniCS component, more precisely a C++ library, with</dt>
<dd>a Python interface, for performing important actions in finite element
programs. DOLFIN makes use of many other FEniCS components and
many external software packages.</dd>
<dt>Viper:  a FEniCS component for quick visualization of finite element</dt>
<dd>meshes and solutions.</dd>
<dt>UFL:    a FEniCS component implementing the <em>unified form language</em></dt>
<dd>for specifying finite element forms in FEniCS programs.
The definition of the forms, typically called <tt class="docutils literal"><span class="pre">a</span></tt> and <tt class="docutils literal"><span class="pre">L</span></tt> in
this tutorial, must have legal UFL syntax. The same applies to
the definition of functionals (see the section <a class="reference internal" href="fundamentals.html#tut-poisson1-functionals"><em>Computing Functionals</em></a>).</dd>
<dt>Class (Python): a programming construction for creating objects</dt>
<dd>containing a set of variables and functions. Most
types of FEniCS objects are defined through the class concept.</dd>
<dt>Instance (Python): an object of a particular type, where the type is</dt>
<dd>implemented as a class. For instance,
<tt class="docutils literal"><span class="pre">mesh</span> <span class="pre">=</span> <span class="pre">UnitInterval(10)</span></tt> creates
an instance of class <tt class="docutils literal"><span class="pre">UnitInterval</span></tt>, which is reached by the
name <tt class="docutils literal"><span class="pre">mesh</span></tt>. (Class <tt class="docutils literal"><span class="pre">UnitInterval</span></tt> is actually just
an interface to a corresponding C++ class in the DOLFIN C++ library.)</dd>
<dt>Class method (Python): a function in a class, reached by dot</dt>
<dd>notation: <tt class="docutils literal"><span class="pre">instance_name.method_name</span></tt></dd>
<dt>argument <tt class="docutils literal"><span class="pre">self</span></tt> (Python): required first parameter in class methods,</dt>
<dd>representing a particular object of the class.
Used in method definitions, but never in calls to a method.
For example, if <tt class="docutils literal"><span class="pre">method(self,</span> <span class="pre">x)</span></tt> is the definition of
<tt class="docutils literal"><span class="pre">method</span></tt> in a class <tt class="docutils literal"><span class="pre">Y</span></tt>, <tt class="docutils literal"><span class="pre">method</span></tt> is called as
<tt class="docutils literal"><span class="pre">y.method(x)</span></tt>, where <tt class="docutils literal"><span class="pre">y</span></tt> is an instance of class <tt class="docutils literal"><span class="pre">Y</span></tt>.
In a call like <tt class="docutils literal"><span class="pre">y.method(x)</span></tt>, <tt class="docutils literal"><span class="pre">method</span></tt> is invoked with
<tt class="docutils literal"><span class="pre">self=y</span></tt>.</dd>
<dt>Class attribute (Python): a variable in a class, reached by</dt>
<dd>dot notation: <tt class="docutils literal"><span class="pre">instance_name.attribute_name</span></tt></dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="overview-of-objects-and-functions">
<h2>Overview of Objects and Functions<a class="headerlink" href="#overview-of-objects-and-functions" title="Permalink to this headline">¶</a></h2>
<p>Most classes in FEniCS have an explanation of the purpose and usage
that can be seen by using the general documentation command <tt class="docutils literal"><span class="pre">pydoc</span></tt>
for Python objects. You can type</p>
<div class="highlight-console" id="index-9"><div class="highlight"><pre><span class="go">pydoc dolfin.X</span>
</pre></div>
</div>
<p>to look up documentation of a Python class <tt class="docutils literal"><span class="pre">X</span></tt> from the DOLFIN
library (<tt class="docutils literal"><span class="pre">X</span></tt> can be <tt class="docutils literal"><span class="pre">UnitSquare</span></tt>, <tt class="docutils literal"><span class="pre">Function</span></tt>, <tt class="docutils literal"><span class="pre">Viper</span></tt>,
etc.). Below is an overview of the most important classes and
functions in FEniCS programs, in the order they typically appear
within programs.</p>
<p><tt class="docutils literal"><span class="pre">UnitSquare(nx,</span> <span class="pre">ny)</span></tt>: generate mesh over the unit square
<span class="math">\([0,1]\times [0,1]\)</span> using <tt class="docutils literal"><span class="pre">nx</span></tt> divisions in <span class="math">\(x\)</span>
direction and <tt class="docutils literal"><span class="pre">ny</span></tt> divisions in <span class="math">\(y\)</span> direction. Each of the
<tt class="docutils literal"><span class="pre">nx*ny</span></tt> squares are divided into two cells of triangular shape.</p>
<p><tt class="docutils literal"><span class="pre">UnitInterval</span></tt>, <tt class="docutils literal"><span class="pre">UnitCube</span></tt>, <tt class="docutils literal"><span class="pre">UnitCircle</span></tt>, <tt class="docutils literal"><span class="pre">UnitSphere</span></tt>,
<tt class="docutils literal"><span class="pre">Interval</span></tt>, <tt class="docutils literal"><span class="pre">Rectangle</span></tt>, and <tt class="docutils literal"><span class="pre">Box</span></tt>: generate mesh over domains
of simple geometric shape, see the section <a class="reference internal" href="prepro.html#tut-prepro"><em>Creating More Complex Domains</em></a>.</p>
<p><tt class="docutils literal"><span class="pre">FunctionSpace(mesh,</span> <span class="pre">element_type,</span> <span class="pre">degree)</span></tt>: a function space
defined over a mesh, with a given element type (e.g., <tt class="docutils literal"><span class="pre">'Lagrange'</span></tt>
or <tt class="docutils literal"><span class="pre">'DG'</span></tt>), with basis functions as polynomials of a specified
degree.</p>
<p><tt class="docutils literal"><span class="pre">Expression(formula,</span> <span class="pre">p1=v1,</span> <span class="pre">p2=v2,</span> <span class="pre">...)</span></tt>: a scalar- or vector-valued
function, given as a mathematical expression <tt class="docutils literal"><span class="pre">formula</span></tt> (string)
written in C++ syntax.  The spatial coordinates in the expression are
named <tt class="docutils literal"><span class="pre">x[0]</span></tt>, <tt class="docutils literal"><span class="pre">x[1]</span></tt>, and <tt class="docutils literal"><span class="pre">x[2]</span></tt>, while time and other physical
parameters can be represented as symbols <tt class="docutils literal"><span class="pre">p1</span></tt>, <tt class="docutils literal"><span class="pre">p2</span></tt>, etc., with
corresponding values <tt class="docutils literal"><span class="pre">v1</span></tt>, <tt class="docutils literal"><span class="pre">v2</span></tt>, etc., initialized through keyword
arguments. These parameters become attributes, whose values can be
modified when desired.</p>
<p><tt class="docutils literal"><span class="pre">Function(V)</span></tt>: a scalar- or vector-valued finite element field in
the function space <tt class="docutils literal"><span class="pre">V</span></tt>. If <tt class="docutils literal"><span class="pre">V</span></tt> is a <tt class="docutils literal"><span class="pre">FunctionSpace</span></tt> object,
<tt class="docutils literal"><span class="pre">Function(V)</span></tt> becomes a scalar field, and with <tt class="docutils literal"><span class="pre">V</span></tt> as a
<tt class="docutils literal"><span class="pre">VectorFunctionSpace</span></tt> object, <tt class="docutils literal"><span class="pre">Function(V)</span></tt> becomes a vector
field.</p>
<p><tt class="docutils literal"><span class="pre">SubDomain</span></tt>: class for defining a subdomain, either a part of the
boundary, an internal boundary, or a part of the domain.  The
programmer must subclass <tt class="docutils literal"><span class="pre">SubDomain</span></tt> and implement the
<tt class="docutils literal"><span class="pre">inside(self,</span> <span class="pre">x,</span> <span class="pre">on_boundary)</span></tt> function (see the section
<a class="reference internal" href="fundamentals.html#tut-poisson1-impl"><em>Implementation (1)</em></a>) for telling whether a point <tt class="docutils literal"><span class="pre">x</span></tt> is inside
the subdomain or not.</p>
<p><tt class="docutils literal"><span class="pre">Mesh</span></tt>: class for representing a finite element mesh, consisting of
cells, vertices, and optionally faces, edges, and facets.</p>
<p><tt class="docutils literal"><span class="pre">MeshFunction</span></tt>: tool for marking parts of the domain or the
boundary.  Used for variable coefficients (&#8220;material properties&#8221;, see
the section <a class="reference internal" href="materials.html#tut-possion-2d-2mat-problem"><em>Working with Two Subdomains</em></a>) or for boundary
conditions (see the section <a class="reference internal" href="materials.html#tut-poisson-mat-neumann"><em>Multiple Neumann, Robin, and Dirichlet Condition</em></a>).</p>
<p><tt class="docutils literal"><span class="pre">DirichletBC(V,</span> <span class="pre">value,</span> <span class="pre">where)</span></tt>: specification of Dirichlet
(essential) boundary conditions via a function space <tt class="docutils literal"><span class="pre">V</span></tt>, a function
<tt class="docutils literal"><span class="pre">value(x)</span></tt> for computing the value of the condition at a point
<tt class="docutils literal"><span class="pre">x</span></tt>, and a specification <tt class="docutils literal"><span class="pre">where</span></tt> of the boundary, either as a
<tt class="docutils literal"><span class="pre">SubDomain</span></tt> subclass instance, a plain function, or as a
<tt class="docutils literal"><span class="pre">MeshFunction</span></tt> instance.  In the latter case, a 4th argument is
provided to describe which subdomain number that describes the
relevant boundary.</p>
<p><tt class="docutils literal"><span class="pre">TestFunction(V)</span></tt>: define a test function on a space <tt class="docutils literal"><span class="pre">V</span></tt> to be
used in a variational form.</p>
<p><tt class="docutils literal"><span class="pre">TrialFunction(V)</span></tt>: define a trial function on a space <tt class="docutils literal"><span class="pre">V</span></tt> to be
used in a variational form to represent the unknown in a finite
element problem.</p>
<p><tt class="docutils literal"><span class="pre">assemble(X)</span></tt>: assemble a matrix, a right-hand side, or a
functional, given a from <tt class="docutils literal"><span class="pre">X</span></tt> written with UFL syntax.</p>
<p><tt class="docutils literal"><span class="pre">assemble_system(a,</span> <span class="pre">L,</span> <span class="pre">bcs)</span></tt>: assemble the matrix and the right-hand
side from a bilinear (<tt class="docutils literal"><span class="pre">a</span></tt>) and linear (<tt class="docutils literal"><span class="pre">L</span></tt>) form written with UFL
syntax. The <tt class="docutils literal"><span class="pre">bcs</span></tt> parameter holds one or more <tt class="docutils literal"><span class="pre">DirichletBC</span></tt>
objects.</p>
<p><tt class="docutils literal"><span class="pre">LinearVariationalProblem(a,</span> <span class="pre">L,</span> <span class="pre">u,</span> <span class="pre">bcs)</span></tt>: define a variational
problem, given a bilinear (<tt class="docutils literal"><span class="pre">a</span></tt>) and linear (<tt class="docutils literal"><span class="pre">L</span></tt>) form, written
with UFL syntax, and one or more <tt class="docutils literal"><span class="pre">DirichletBC</span></tt> objects stored in
<tt class="docutils literal"><span class="pre">bcs</span></tt>.</p>
<p><tt class="docutils literal"><span class="pre">LinearVariationalSolver(problem)</span></tt>: create solver object for a
linear variational problem object (<tt class="docutils literal"><span class="pre">problem</span></tt>).</p>
<p><tt class="docutils literal"><span class="pre">solve(A,</span> <span class="pre">U,</span> <span class="pre">b)</span></tt>: solve a linear system with <tt class="docutils literal"><span class="pre">A</span></tt> as coefficient
matrix (<tt class="docutils literal"><span class="pre">Matrix</span></tt> object), <tt class="docutils literal"><span class="pre">U</span></tt> as unknown (<tt class="docutils literal"><span class="pre">Vector</span></tt> object), and
<tt class="docutils literal"><span class="pre">b</span></tt> as right-hand side (<tt class="docutils literal"><span class="pre">Vector</span></tt> object).  Usually, <tt class="docutils literal"><span class="pre">U</span> <span class="pre">=</span>
<span class="pre">u.vector()</span></tt>, where <tt class="docutils literal"><span class="pre">u</span></tt> is a <tt class="docutils literal"><span class="pre">Function</span></tt> object representing the
unknown finite element function of the problem, while <tt class="docutils literal"><span class="pre">A</span></tt> and <tt class="docutils literal"><span class="pre">b</span></tt>
are computed by calls to <tt class="docutils literal"><span class="pre">assemble</span></tt> or <tt class="docutils literal"><span class="pre">assemble_system</span></tt>.</p>
<p><tt class="docutils literal"><span class="pre">plot(q)</span></tt>: quick visualization of a mesh, function, or mesh function
<tt class="docutils literal"><span class="pre">q</span></tt>, using the Viper component in FEniCS.</p>
<p><tt class="docutils literal"><span class="pre">interpolate(func,</span> <span class="pre">V)</span></tt>: interpolate a formula or finite element
function <tt class="docutils literal"><span class="pre">func</span></tt> onto the function space <tt class="docutils literal"><span class="pre">V</span></tt>.</p>
<p><tt class="docutils literal"><span class="pre">project(func,</span> <span class="pre">V)</span></tt>: project a formula or finite element function
<tt class="docutils literal"><span class="pre">func</span></tt> onto the function space <tt class="docutils literal"><span class="pre">V</span></tt>.</p>
</div>
<div class="section" id="user-defined-functions">
<span id="tut-app-cpp-functions"></span><h2>User-Defined Functions<a class="headerlink" href="#user-defined-functions" title="Permalink to this headline">¶</a></h2>
<p>When defining a function in terms of a mathematical expression inside
a string formula, e.g.,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">myfunc</span> <span class="o">=</span> <span class="n">Expression</span><span class="p">(</span><span class="s">&#39;sin(x[0])*cos(x[1])&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>the expression contained in the first argument will be turned into a
C++ function and compiled to gain efficiency. Therefore, the syntax
used in the expression must be valid C++ syntax.  Most Python syntax
for mathematical expressions are also valid C++ syntax, but power
expressions make an exception: <tt class="docutils literal"><span class="pre">p**a</span></tt> must be written as
<tt class="docutils literal"><span class="pre">pow(p,a)</span></tt> in C++ (this is also an alternative Python syntax).  The
following mathematical functions can be used directly in C++
expressions when defining <tt class="docutils literal"><span class="pre">Expression</span></tt> objects: <tt class="docutils literal"><span class="pre">cos</span></tt>, <tt class="docutils literal"><span class="pre">sin</span></tt>,
<tt class="docutils literal"><span class="pre">tan</span></tt>, <tt class="docutils literal"><span class="pre">acos</span></tt>, <tt class="docutils literal"><span class="pre">asin</span></tt>, <tt class="docutils literal"><span class="pre">atan</span></tt>, <tt class="docutils literal"><span class="pre">atan2</span></tt>, <tt class="docutils literal"><span class="pre">cosh</span></tt>, <tt class="docutils literal"><span class="pre">sinh</span></tt>,
<tt class="docutils literal"><span class="pre">tanh</span></tt>, <tt class="docutils literal"><span class="pre">exp</span></tt>, <tt class="docutils literal"><span class="pre">frexp</span></tt>, <tt class="docutils literal"><span class="pre">ldexp</span></tt>, <tt class="docutils literal"><span class="pre">log</span></tt>, <tt class="docutils literal"><span class="pre">log10</span></tt>, <tt class="docutils literal"><span class="pre">modf</span></tt>,
<tt class="docutils literal"><span class="pre">pow</span></tt>, <tt class="docutils literal"><span class="pre">sqrt</span></tt>, <tt class="docutils literal"><span class="pre">ceil</span></tt>, <tt class="docutils literal"><span class="pre">fabs</span></tt>, <tt class="docutils literal"><span class="pre">floor</span></tt>, and <tt class="docutils literal"><span class="pre">fmod</span></tt>.
Moreover, the number <span class="math">\(\pi\)</span> is available as the symbol <tt class="docutils literal"><span class="pre">pi</span></tt>.
All the listed functions are taken from the <tt class="docutils literal"><span class="pre">cmath</span></tt> C++ header file,
and one may hence consult documentation of <tt class="docutils literal"><span class="pre">cmath</span></tt> for more
information on the various functions.</p>
<p>Parameters in expression strings must be initialized via keyword
arguments when creating the <tt class="docutils literal"><span class="pre">Expression</span></tt> object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">myfunc</span> <span class="o">=</span> <span class="n">Expression</span><span class="p">(</span><span class="s">&#39;sin(w_x*x[0])*cos(w_y*x[1])&#39;</span><span class="p">,</span>
                     <span class="n">w_x</span><span class="o">=</span><span class="n">pi</span><span class="p">,</span> <span class="n">w_y</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="linear-solvers-and-preconditioners">
<span id="tut-app-solver-prec"></span><h2>Linear Solvers and Preconditioners<a class="headerlink" href="#linear-solvers-and-preconditioners" title="Permalink to this headline">¶</a></h2>
<p>The following solution methods for linear systems can be accessed in
FEniCS programs:</p>
<table border="1" class="docutils">
<colgroup>
<col width="49%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Method</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">'lu'</span></tt></td>
<td>sparse LU factorization (Gaussian elim.)</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">'cholesky'</span></tt></td>
<td>sparse Cholesky factorization</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">'cg'</span></tt></td>
<td>Conjugate gradient method</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">'gmres'</span></tt></td>
<td>Generalized minimal residual method</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">'bicgstab'</span></tt></td>
<td>Biconjugate gradient stabilized method</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">'minres'</span></tt></td>
<td>Minimal residual method</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">'tfqmr'</span></tt></td>
<td>Transpose-free quasi-minimal residual method</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">'richardson'</span></tt></td>
<td>Richardson method</td>
</tr>
</tbody>
</table>
<p>Possible choices of preconditioners include</p>
<table border="1" class="docutils">
<colgroup>
<col width="49%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Method</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">'none'</span></tt></td>
<td>No preconditioner</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">'ilu'</span></tt></td>
<td>Incomplete LU factorization</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">'icc'</span></tt></td>
<td>Incomplete Cholesky factorization</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">'jacobi'</span></tt></td>
<td>Jacobi iteration</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">'bjacobi'</span></tt></td>
<td>Block Jacobi iteration</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">'sor'</span></tt></td>
<td>Successive over-relaxation</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">'amg'</span></tt></td>
<td>Algebraic multigrid (BoomerAMG or ML)</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">'additive_schwarz'</span></tt></td>
<td>Additive Schwarz</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">'hypre_amg'</span></tt></td>
<td>Hypre algebraic multigrid (BoomerAMG)</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">'hypre_euclid'</span></tt></td>
<td>Hypre parallel incomplete LU factorization</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">'hypre_parasails'</span></tt></td>
<td>Hypre parallel sparse approximate inverse</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">'ml_amg'</span></tt></td>
<td>ML algebraic multigrid</td>
</tr>
</tbody>
</table>
<p>Many of the choices listed above are only offered by a specific
backend, so setting the backend appropriately is necessary for being
able to choose a desired linear solver or preconditioner.</p>
<p>An up-to-date list of the available solvers and preconditioners in
FEniCS can be produced by</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">list_linear_solver_methods</span><span class="p">()</span>
<span class="k">print</span> <span class="n">list_krylov_solver_preconditioners</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="using-a-backend-specific-solver">
<span id="tut-epetra"></span><h2>Using a Backend-Specific Solver<a class="headerlink" href="#using-a-backend-specific-solver" title="Permalink to this headline">¶</a></h2>
<span class="target" id="index-10"></span><p id="index-11">The linear algebra backend determines the specific data structures
that are used in the <tt class="docutils literal"><span class="pre">Matrix</span></tt> and <tt class="docutils literal"><span class="pre">Vector</span></tt> classes. For example,
with the PETSc backend, <tt class="docutils literal"><span class="pre">Matrix</span></tt> encapsulates a PETSc matrix storage
structure, and <tt class="docutils literal"><span class="pre">Vector</span></tt> encapsulates a PETSc vector storage
structure.  Sometimes one wants to perform operations directly on
(say) the underlying PETSc objects. These can be fetched by</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A_PETSc</span> <span class="o">=</span>
<span class="n">down_cast</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">mat</span><span class="p">()</span> <span class="n">b_PETSc</span> <span class="o">=</span> <span class="n">down_cast</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">vec</span><span class="p">()</span> <span class="n">U_PETSc</span> <span class="o">=</span>
<span class="n">down_cast</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">vector</span><span class="p">())</span><span class="o">.</span><span class="n">vec</span><span class="p">()</span>
</pre></div>
</div>
<p>Here, <tt class="docutils literal"><span class="pre">u</span></tt> is a <tt class="docutils literal"><span class="pre">Function</span></tt>, <tt class="docutils literal"><span class="pre">A</span></tt> is a <tt class="docutils literal"><span class="pre">Matrix</span></tt>, and <tt class="docutils literal"><span class="pre">b</span></tt> is a
<tt class="docutils literal"><span class="pre">Vector</span></tt>.  The same syntax applies if we want to fetch the
underlying Epetra, uBLAS, or MTL4 matrices and vectors.</p>
<span class="target" id="index-12"></span><p id="index-13">Sometimes one wants to implement tailored solution algorithms, using
special features of the underlying numerical packages.  Here is an
example where we create an ML preconditioned Conjugate Gradient solver
by programming with Trilinos-specific objects directly.  Given a
linear system <span class="math">\(AU=b\)</span>, represented by a <tt class="docutils literal"><span class="pre">Matrix</span></tt> object <tt class="docutils literal"><span class="pre">A</span></tt>,
and two <tt class="docutils literal"><span class="pre">Vector</span></tt> objects <tt class="docutils literal"><span class="pre">U</span></tt> and <tt class="docutils literal"><span class="pre">b</span></tt> in a Python program, the
purpose is to set up a solver using the Aztec Conjugate Gradient
method from Trilinos&#8217; Aztec library and combine that solver with the
algebraic multigrid preconditioner ML from the ML library in
Trilinos. Since the various parts of Trilinos are mirrored in Python
through the PyTrilinos package, we can operate directly on
Trilinos-specific objects.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">PyTrilinos</span> <span class="kn">import</span> <span class="n">Epetra</span><span class="p">,</span> <span class="n">AztecOO</span><span class="p">,</span> <span class="n">TriUtils</span><span class="p">,</span> <span class="n">ML</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;&#39;&#39;You Need to have PyTrilinos with&#39;</span>
<span class="s">Epetra, AztecOO, TriUtils and ML installed</span>
<span class="s">for this demo to run&#39;&#39;&#39;</span>
    <span class="nb">exit</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">dolfin</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">has_la_backend</span><span class="p">(</span><span class="s">&#39;Epetra&#39;</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;Warning: Dolfin is not compiled with Trilinos&#39;</span>
    <span class="nb">exit</span><span class="p">()</span>

<span class="n">parameters</span><span class="p">[</span><span class="s">&#39;linear_algebra_backend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Epetra&#39;</span>

<span class="c"># create matrix A and vector b in the usual way</span>
<span class="c"># u is a Function</span>

<span class="c"># Fetch underlying Epetra objects</span>
<span class="n">A_epetra</span> <span class="o">=</span> <span class="n">down_cast</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">mat</span><span class="p">()</span>
<span class="n">b_epetra</span> <span class="o">=</span> <span class="n">down_cast</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">vec</span><span class="p">()</span>
<span class="n">U_epetra</span> <span class="o">=</span> <span class="n">down_cast</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">vector</span><span class="p">())</span><span class="o">.</span><span class="n">vec</span><span class="p">()</span>

<span class="c"># Sets up the parameters for ML using a python dictionary</span>
<span class="n">ML_param</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;max levels&quot;</span>        <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s">&quot;output&quot;</span>            <span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s">&quot;smoother: type&quot;</span>    <span class="p">:</span> <span class="s">&quot;ML symmetric Gauss-Seidel&quot;</span><span class="p">,</span>
            <span class="s">&quot;aggregation: type&quot;</span> <span class="p">:</span> <span class="s">&quot;Uncoupled&quot;</span><span class="p">,</span>
            <span class="s">&quot;ML validate parameter list&quot;</span> <span class="p">:</span> <span class="bp">False</span>
<span class="p">}</span>

<span class="c"># Create the preconditioner</span>
<span class="n">prec</span> <span class="o">=</span> <span class="n">ML</span><span class="o">.</span><span class="n">MultiLevelPreconditioner</span><span class="p">(</span><span class="n">A_epetra</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
<span class="n">prec</span><span class="o">.</span><span class="n">SetParameterList</span><span class="p">(</span><span class="n">ML_param</span><span class="p">)</span>
<span class="n">prec</span><span class="o">.</span><span class="n">ComputePreconditioner</span><span class="p">()</span>

<span class="c"># Create solver and solve system</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">AztecOO</span><span class="o">.</span><span class="n">AztecOO</span><span class="p">(</span><span class="n">A_epetra</span><span class="p">,</span> <span class="n">U_epetra</span><span class="p">,</span> <span class="n">b_epetra</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">SetPrecOperator</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">SetAztecOption</span><span class="p">(</span><span class="n">AztecOO</span><span class="o">.</span><span class="n">AZ_solver</span><span class="p">,</span> <span class="n">AztecOO</span><span class="o">.</span><span class="n">AZ_cg</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">SetAztecOption</span><span class="p">(</span><span class="n">AztecOO</span><span class="o">.</span><span class="n">AZ_output</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">Iterate</span><span class="p">(</span><span class="n">MaxIters</span><span class="o">=</span><span class="mi">1550</span><span class="p">,</span> <span class="n">Tolerance</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>

<span class="n">plot</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="installing-fenics">
<span id="tut-app-install"></span><h2>Installing FEniCS<a class="headerlink" href="#installing-fenics" title="Permalink to this headline">¶</a></h2>
<p>The FEniCS software components are available for Linux, Windows and
Mac OS X platforms. Detailed information on how to get FEniCS running
on such machines are available at the <tt class="docutils literal"><span class="pre">fenicsproject.org</span></tt> website.
Here are just some quick descriptions and recommendations by the
author.</p>
<p>To make the installation of FEniCS as painless and reliable as
possible, the reader is strongly recommended to use Ubuntu Linux.
(Even though Mac users now can get FEniCS by a one-click install, I
recommend using Ubuntu on Mac, unless you have high Unix competence
and much experience with compiling and linking C++ libraries on Mac OS
X.)  Any standard PC can easily be equipped with Ubuntu Linux, which
may live side by side with either Windows or Mac OS X or another Linux
installation.  Basically, you download Ubuntu from
<tt class="docutils literal"><span class="pre">www.ubuntu.com/getubuntu/download</span></tt>, burn the file on a CD or copy
it to a memory stick, reboot the machine with the CD or memory stick,
and answer some usually straightforward questions (if necessary).  On
Windows, Wubi is a tool that automatically installs Ubuntu on the
machine. Just give a user~name and password for the Ubuntu
installation, and Wubi performs the rest.  The graphical user
interface (GUI) of Ubuntu is quite similar to both Windows 7 and Mac
OS X, but to be efficient when doing science with FEniCS this author
recommends to run programs in a terminal window and write them in a
text editor like Emacs or Vim. You can employ an integrated
development environment such as Eclipse, but intensive FEniCS
developers and users tend to find terminal windows and plain text
editors more user friendly.</p>
<p>Instead of making it possible to boot your machine with the Linux
Ubuntu operating system, you can run Ubuntu in a separate window in
your existing operation system. There are several solutions to chose
among: the free <em>VirtualBox</em> and <em>VMWare Player</em>, or the commercial
tools <em>VMWare Fusion</em> and <em>Parallels</em> (just search for the names to
download the programs).</p>
<p>Once the Ubuntu window is up and running, FEniCS is painlessly
installed by</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">sudo apt-get install fenics</span>
</pre></div>
</div>
<p>Sometimes the FEniCS software in a standard Ubuntu installation lacks
some recent features and bug fixes. Visiting the detailed download
page on <a class="reference external" href="fenicsproject.org">fenicsproject.org</a> and copying a few Unix commands is all
you have to do to install a newer version of the software.</p>
</div>
<div class="section" id="troubleshooting-compilation-problems">
<span id="tut-trouble"></span><h2>Troubleshooting: Compilation Problems<a class="headerlink" href="#troubleshooting-compilation-problems" title="Permalink to this headline">¶</a></h2>
<span class="target" id="index-14"></span><p id="index-15">Expressions and variational forms in a FEniCS program need to be
compiled to C++ and linked with libraries if the expressions or forms
have been modified since last time they were compiled.  The tool
Instant, which is part of the FEniCS software suite, is used for
compiling and linking C++ code so that it can be used with Python.</p>
<p>Sometimes the compilation fails. You can see from the series of error
messages which statement in the Python program that led to a
compilation problem. Make sure to scroll back and identify whether the
problematic line is associated with an expression, variational form,
or the solve step.</p>
<p>The final line in the output of error messages points to a log file
from the compilation where one can examine the error messages from the
compiler. It is usually the last lines of this log file that are of
interest. Occasionally, the compiler&#8217;s message can quickly lead to an
understanding of the problem.
A more fruitful approach is normally to examine the below list
of common compilation problems and their remedies.</p>
<div class="section" id="problems-with-the-instant-cache">
<h3>Problems with the Instant Cache<a class="headerlink" href="#problems-with-the-instant-cache" title="Permalink to this headline">¶</a></h3>
<p>Instant remembers information about previous compilations and versions
of your program. Sometimes removal of this information can solve the
problem. Just run</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">instant-clean</span>
</pre></div>
</div>
<p>in a terminal window.</p>
</div>
<div class="section" id="syntax-errors-in-expressions">
<h3>Syntax Errors in Expressions<a class="headerlink" href="#syntax-errors-in-expressions" title="Permalink to this headline">¶</a></h3>
<p>If the compilation problem arises from line with an <tt class="docutils literal"><span class="pre">Expression</span></tt>
object, examine the syntax of the expression carefully. The section
<a class="reference internal" href="#tut-app-cpp-functions"><em>User-Defined Functions</em></a> contains some information on valid
syntax. You may also want to examine the log file, pointed to in the
last line in the output of error messages. The compiler&#8217;s message
about the syntax problem may lead you to a solution.</p>
<p>Some common problems are</p>
<blockquote>
<div><ol class="arabic simple">
<li>using <tt class="docutils literal"><span class="pre">a**b</span></tt> for exponentiation (illegal in C++) instead of
<tt class="docutils literal"><span class="pre">pow(a,</span> <span class="pre">b)</span></tt>,</li>
<li>forgetting that the spatial coordinates are denoted by a vector
<tt class="docutils literal"><span class="pre">x</span></tt>,</li>
<li>forgetting that the <span class="math">\(x\)</span>, <span class="math">\(y\)</span>, and <span class="math">\(z\)</span>
coordinates in space correspond to <tt class="docutils literal"><span class="pre">x[0]</span></tt>, <tt class="docutils literal"><span class="pre">x[1]</span></tt>, and
<tt class="docutils literal"><span class="pre">x[2]</span></tt>, respectively.</li>
</ol>
</div></blockquote>
<p>Failure to initialize parameters in the expressions lead to a
compilation error where this problem is explicitly pointed out.</p>
</div>
<div class="section" id="problems-in-the-solve-step">
<h3>Problems in the Solve Step<a class="headerlink" href="#problems-in-the-solve-step" title="Permalink to this headline">¶</a></h3>
<p>Sometimes the problem lies in the solve step where a variational form
is turned into a system of algebraic equations.  The error message
&#8220;Unable to extract all indicies&#8221; points to a problem with the
variational form. Common errors include</p>
<blockquote>
<div><ol class="arabic simple">
<li>missing either the <tt class="docutils literal"><span class="pre">TrialFunction</span></tt> or the <tt class="docutils literal"><span class="pre">TestFunction</span></tt> object,</li>
<li>no terms without <tt class="docutils literal"><span class="pre">TrialFunction</span></tt> objects.</li>
<li>mathematically invalid operations in the variational form.</li>
</ol>
</div></blockquote>
<p>The first problem implies that one cannot make a matrix system or
system of nonlinear algebraic equations out of the variational form.
The second problem means that there is no &#8220;right-hand side&#8221; terms in
the PDE with known quantities. Sometimes this is seemingly the case
mathematically because the &#8220;right-hand side&#8221; is zero. Variational
forms must represent this case as <tt class="docutils literal"><span class="pre">Constant(0)*v*dx</span></tt> where <tt class="docutils literal"><span class="pre">v</span></tt> is
a <tt class="docutils literal"><span class="pre">TestFunction</span></tt> object.  An example of the third problem is to take
the <tt class="docutils literal"><span class="pre">inner</span></tt> product of a scalar and a vector (causing in this
particular case the error message to be &#8220;Shape mismatch&#8221;).</p>
</div>
<div class="section" id="all-programs-fail-to-compile">
<h3>All Programs Fail to Compile<a class="headerlink" href="#all-programs-fail-to-compile" title="Permalink to this headline">¶</a></h3>
<p>On Ubuntu Linux unfinished updates of the system (run by Update
Manager) may causes all compilations to fail. When previously working
programs no longer can be compiled, reboot Ubuntu, run the Update
Manager, and wait until it has finished. Try compiling a working
program again.</p>
</div>
</div>
<div class="section" id="books-on-the-finite-element-method">
<span id="tut-appendix-books"></span><h2>Books on the Finite Element Method<a class="headerlink" href="#books-on-the-finite-element-method" title="Permalink to this headline">¶</a></h2>
<p>There are a large number of books on the finite element method.  The
books typically fall in either of two categories: the abstract
mathematical version of the method and the engineering &#8220;structural
analysis&#8221; formulation. FEniCS builds heavily on concepts in the
abstract mathematical exposition.  An easy-to-read book, which
provides a good general background for using FEniCS, is Gockenbach
<a class="reference internal" href="bib.html#gockenbach2006" id="id1">[Gockenbach2006]</a>. The book by Donea and Huerta <a class="reference internal" href="bib.html#doneahuerta2003" id="id2">[DoneaHuerta2003]</a> has
a similar style, but aims at readers with interest in fluid flow
problems. Hughes <a class="reference internal" href="bib.html#hughes1987" id="id3">[Hughes1987]</a> is also highly recommended, especially
for those interested in solid mechanics and heat transfer
applications.</p>
<p>Readers with background in the engineering &#8220;structural analysis&#8221;
version of the finite element method may find Bickford <a class="reference internal" href="bib.html#bickford1994" id="id4">[Bickford1994]</a>
as an attractive bridge over to the abstract mathematical formulation
that FEniCS builds upon.  Those who have a weak background in
differential equations in general should consult a more fundamental
book, and Eriksson {em et al}. <a class="reference internal" href="bib.html#erikssonestephansboetal1996" id="id5">[ErikssonEstepHansboEtAl1996]</a> is a
very good choice.  On the other hand, FEniCS users with a strong
background in mathematics and interest in the mathematical properties
of the finite element method, will appreciate the texts by Brenner and
Scott <a class="reference internal" href="bib.html#brennerscott2008" id="id6">[BrennerScott2008]</a>, Braess <a class="reference internal" href="bib.html#braess2007" id="id7">[Braess2007]</a>, Ern and Guermond
<a class="reference internal" href="bib.html#ernguermond2004" id="id8">[ErnGuermond2004]</a>, Quarteroni and Valli <a class="reference internal" href="bib.html#quarteronivalli1994" id="id9">[QuarteroniValli1994]</a>, or
Ciarlet <a class="reference internal" href="bib.html#ciarlet2002" id="id10">[Ciarlet2002]</a>.</p>
</div>
<div class="section" id="books-on-python">
<span id="tut-appendix-pybooks"></span><h2>Books on Python<a class="headerlink" href="#books-on-python" title="Permalink to this headline">¶</a></h2>
<p>Two very popular introductory books on Python are &#8220;Learning Python&#8221; by
Lutz <a class="reference internal" href="bib.html#lutz2007" id="id11">[Lutz2007]</a> and &#8220;Practical Python&#8221; by Hetland <a class="reference internal" href="bib.html#hetland2002" id="id12">[Hetland2002]</a>.
More advanced and comprehensive books include &#8220;Programming Python&#8221; by
Lutz <a class="reference internal" href="bib.html#lutz2006" id="id13">[Lutz2006]</a>, and &#8220;Python Cookbook&#8221; <a class="reference internal" href="bib.html#martelliascher2005" id="id14">[MartelliAscher2005]</a> and
&#8220;Python in a Nutshell&#8221; <a class="reference internal" href="bib.html#martelli2006" id="id15">[Martelli2006]</a> by Martelli.  The web page
<tt class="docutils literal"><span class="pre">http://wiki.python.org/moin/PythonBooks</span></tt> lists numerous additional
books.  Very few texts teach Python in a mathematical and numerical
context, but the references <a class="reference internal" href="bib.html#langtangen2008" id="id16">[Langtangen2008]</a> <a class="reference internal" href="bib.html#langtangen2009a" id="id17">[Langtangen2009a]</a>
<a class="reference internal" href="bib.html#kiusalaas2005" id="id18">[Kiusalaas2005]</a> are exceptions.</p>
</div>
<div class="section" id="acknowledgments">
<h2>Acknowledgments<a class="headerlink" href="#acknowledgments" title="Permalink to this headline">¶</a></h2>
<p>The author is very thankful to Johan Hake, Anders Logg, Kent-Andre
Mardal, and Kristian Valen-Sendstad for promptly answering all my
questions about FEniCS functionality and for implementing all my
requests.  I will in particular thank Professor Douglas Arnold for
very valuable feedback on the text. Øystein Sørensen pointed out a lot
of typos and contributed with many helpful comments.  Many errors and
typos were also reported by Mauricio Angeles, Ida Drøsdal, Hans
Ekkehard Plesser, and Marie Rognes.  Ekkehard Ellmann as well as two
anonymous reviewers provided a series of suggestions and improvements.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="wrapper">
  <div class="footer">
    <div class="footer-nav">
      <div class="span-6">
	<h4>Usage documentation</h4>
	<ul>
	  <li><a href="/documentation/tutorial/">Tutorial</a></li>
	  <li><a href="/documentation/dolfin/dev/python/">Python API</a></li>
	  <li><a href="/documentation/dolfin/dev/cpp/">C++ API</a></li>
          <li><a href="/releases/">Release notes</a></li>
	</ul>
      </div>
      <div class="span-6">
	<h4>Developer resources</h4>
	<ul>
	  <li><a href="/buildbot/">Buildbot</a></li>
	  <li><a href="/benchbot/">Benchbot</a></li>
	  <li><a href="https://bitbucket.org/fenics-project/">FEniCS on Bitbucket</a></li>
	  <li><a href="/pub/">File archive</a></li>
	</ul>
      </div>
      <div class="span-6 last">
	<h4>Search this site</h4>
	<div id="searchbox">
	  <form class="search" action="/search.html" method="get">
	    <input type="text" name="q" size="18" />
	    <input type="submit" value="Go" />
	    <input type="hidden" name="check_keywords" value="yes" />
	    <input type="hidden" name="area" value="default" />
	  </form>
	</div>
      </div>
    </div>
    &copy; Copyright 2015, <a href="/">The FEniCS Project</a>. (<a href="/disclaimer.html">Disclaimer</a>)
  </div>
</div>

  </body>
</html>